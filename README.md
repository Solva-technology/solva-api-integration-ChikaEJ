# Telegram Bot (aiogram)

## üìå –¶–µ–ª—å

–°–æ–±—Ä–∞—Ç—å Telegram-–±–æ—Ç–∞ –Ω–∞ **aiogram (v3+)** —Å **inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –∏–∑ –¥–≤—É—Ö –∫–Ω–æ–ø–æ–∫**, –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ callback\_data**:

1. ¬´–ü–æ–≥–æ–¥–∞¬ª ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ **OpenWeatherMap**.
2. ¬´–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞¬ª ‚Äî –º–∏–Ω–∏-–∏–≥—Ä–∞ —Å –±–æ—Ç–æ–º.

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ

* Python **3.11+**, aiogram **3.x**, aiohttp **3.x**.
* –ó–∞–ø—É—Å–∫ –≤ Docker, docker-compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
* –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å).
* –õ–æ–≥–∏: structured (JSON) –Ω–∞ stdout, —É—Ä–æ–≤–µ–Ω—å –∑–∞–¥–∞—ë—Ç—Å—è `LOG_LEVEL`.
* –¢–µ—Å—Ç—ã: pytest.
* –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–≥–æ–¥—ã (–≥–æ—Ä–æ–¥ + —Ä–µ–∑—É–ª—å—Ç–∞—Ç) –≤ MongoDB.
* –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–∏—Ç—å **MongoWeiver**.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

* –ö–æ–º–∞–Ω–¥–∞ `/start` –≤—ã–≤–æ–¥–∏—Ç inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É:

  * –ö–Ω–æ–ø–∫–∞ 1: ¬´–ü–æ–≥–æ–¥–∞¬ª (`cb: weather:ask_city`).
  * –ö–Ω–æ–ø–∫–∞ 2: ¬´–ö–ù–ë¬ª (`cb: rps:menu`).
* –í—Å–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ **CallbackQuery**.
* **–ü–æ–≥–æ–¥–∞**:

  * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenWeatherMap Current Weather Data API.
  * –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è: `metric`, —è–∑—ã–∫: `ru`.
  * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API (4xx/5xx/—Ç–∞–π–º–∞—É—Ç).
  * –ö–∞–∂–¥—ã–π —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ MongoDB (–≥–æ—Ä–æ–¥, –ø–æ–≥–æ–¥–∞, –¥–∞—Ç–∞/–≤—Ä–µ–º—è).
* **–ò–≥—Ä–∞ –ö–ù–ë**:

  * –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∂–µ—Å—Ç —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏.
  * –ë–æ—Ç —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –≤—ã–±–∏—Ä–∞–µ—Ç —Å–≤–æ–π –∂–µ—Å—Ç.
  * –û—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º ¬´–°—ã–≥—Ä–∞—Ç—å –µ—â—ë¬ª.

### –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª `sessions.json` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
* –§–∞–π–ª –æ—á–∏—â–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ **2 –º–∏–Ω—É—Ç—ã**.
* –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞–ª > 3 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 2 –º–∏–Ω—É—Ç—ã ‚Äî –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–∞.

---

## üîë –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.example)

```env
BOT_TOKEN=000000000:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
OPENWEATHER_API_KEY=your_owm_api_key
OPENWEATHER_BASE_URL=https://api.openweathermap.org/data/2.5
MONGO_URI=mongodb://mongo:27017
MONGO_DB=weather_bot
LOG_LEVEL=INFO
```
---

## üìÇ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
  main.py                 # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
  keyboards/
    inline.py             # inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  services/
    weather_client.py     # aiohttp-–∫–ª–∏–µ–Ω—Ç OpenWeatherMap
    mongo_client.py       # –∑–∞–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ MongoDB
    rps.py                # –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
    sessions.py           # —Ä–∞–±–æ—Ç–∞ —Å sessions.json
  handlers/
    start.py           
    weather.py
    rps.py
  utils/
    logging.py

sessions.json             # –∞–Ω–∞–ª–æ–≥ —Å–µ—Å—Å–∏–π (–∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞)
tests/
  test_weather_client.py
  test_rps.py
  test_callbacks.py

Dockerfile
docker-compose.yml
requirements.txt
README.md
```

---

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

### –ü–æ–≥–æ–¥–∞
1. `/start` ‚Üí inline-–∫–Ω–æ–ø–∫–∏ \[¬´–ü–æ–≥–æ–¥–∞¬ª, ¬´–ö–ù–ë¬ª].
2. `cb=weather:ask_city` ‚Üí –±–æ—Ç –ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –≥–æ—Ä–æ–¥.
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –≥–æ—Ä–æ–¥–∞.
4. `cb=weather:get:<city>` ‚Üí –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É –∏ –≤—ã–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ.
5. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MongoDB.
6. –û—à–∏–±–∫–∏ API ‚Üí –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ ¬´–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞¬ª.
7. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞–ª > 3 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 2 –º–∏–Ω—É—Ç—ã ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ –æ—á–∏—Å—Ç–∫–∏ `sessions.json`.

### –ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞

1. `cb=rps:menu` ‚Üí –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏: ¬´–ö–∞–º–µ–Ω—å¬ª, ¬´–ù–æ–∂–Ω–∏—Ü—ã¬ª, ¬´–ë—É–º–∞–≥–∞¬ª.
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∂–µ—Å—Ç.
3. –ë–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –∂–µ—Å—Ç.
4. –†–µ–∑—É–ª—å—Ç–∞—Ç + –∫–Ω–æ–ø–∫–∞ ¬´–°—ã–≥—Ä–∞—Ç—å –µ—â—ë¬ª.
---

## üìú –§–æ—Ä–º–∞—Ç callback\_data

* `weather:ask_city`
* `weather:get:<city>`
* `rps:menu`
* `rps:pick:<move>` (`rock|paper|scissors`)

---

## ‚úÖ –¢–µ—Å—Ç—ã

* `test_rps.py`: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ö–æ–¥–æ–≤ –ø—Ä–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ä–∞–Ω–¥–æ–º–µ.
* `test_weather_client.py`: –º–æ–∫ `aiohttp` ‚Üí –æ—Ç–≤–µ—Ç—ã 200/404/500/—Ç–∞–π–º–∞—É—Ç.
* `test_callbacks.py`: –ø—Ä–æ–≤–µ—Ä–∫–∞ callback\_data.

---

## üìå –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

* `/start` –≤—ã–≤–æ–¥–∏—Ç inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å 2 –∫–Ω–æ–ø–∫–∞–º–∏.
* –í—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ `CallbackQuery`.
* –ü–æ–≥–æ–¥–∞: –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
* –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ø–æ–≥–æ–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ MongoDB.
* Mongoweiver –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 3 –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∑–∞ 2 –º–∏–Ω—É—Ç—ã (–∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ `sessions.json`).
* –ö–ù–ë: –∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ ¬´–°—ã–≥—Ä–∞—Ç—å –µ—â—ë¬ª.
* –ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ Docker, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `.env`.
* –õ–æ–≥–∏ JSON, –ª–∏–Ω—Ç–µ—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ.

---
